<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.eat.today.member.query.mapper.MemberMapper">

    <!-- 전화번호로 회원 아이디 조회 -->
    <select id="selectIdByPhone" parameterType="string" resultType="string">
        SELECT m.member_id
        FROM member m
        WHERE m.member_phone = #{memberPhone}  -- #{memberPhone} 이부분이 사용자 입력값(postman 으로 할 때)
    </select>

    <!-- 내 프로필 조회 -->
    <select id="findMyProfile" parameterType="string" resultType="com.eat.today.member.query.dto.FindProfileDTO">
        SELECT m.member_name,
               m.member_birth,
               m.member_phone,
               m.member_level,
               CASE
                   WHEN m.member_active = 1 THEN '활동회원'
                   WHEN m.member_active = 0 THEN '비활성 회원'
                   END member_status                            -- 1일때는 활동회원 0일때는 비활성 회원 출력
        FROM member m
        WHERE m.member_no = #{memberNo};
    </select>

<!--   받은 포인트에 따른 등급을 확인할 수 있다.-->
    <select id="findMyLevel" resultType="com.eat.today.member.query.dto.FindMyLevelDTO">
    SELECT
    m.member_name AS memberName,
    m.member_level AS memberLevel,
    CASE
    WHEN m.member_level IS NULL THEN '관리자'
    WHEN m.member_level >= 500 THEN '골드'
    WHEN m.member_level >= 300 THEN '실버'
    ELSE '브론즈'
    END AS memberLevelLabel
    FROM member m
    LEFT JOIN role r ON r.role_no = m.member_role_no
    WHERE m.member_no = #{memberNo};
    </select>
</mapper>


